{% extends 'base.html' %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="row">
    <div class="col-md-8 offset-md-2">
      <div class="card">
        <div class="card-body">
          <h4 class="card-title mb-3">{{ title }}</h4>
          <form method="post">
            {% csrf_token %}
            {% for field in form %}
              {% if field.name == 'ativo' %}
                <div class="form-check mb-3">
                  {{ field }}
                  <label class="form-check-label" for="{{ field.id_for_label }}">{{ field.label }}</label>
                  {% if field.help_text %}<div class="form-text">{{ field.help_text }}</div>{% endif %}
                  {% for error in field.errors %}<div class="invalid-feedback d-block">{{ error }}</div>{% endfor %}
                </div>
              {% else %}
                <div class="mb-3">
                  {{ field.label_tag }}
                  {{ field }}
                  {% if field.help_text %}<div class="form-text">{{ field.help_text }}</div>{% endif %}
                  {% for error in field.errors %}<div class="invalid-feedback d-block">{{ error }}</div>{% endfor %}
                </div>
              {% endif %}
            {% endfor %}
            <div class="d-flex gap-2">
              <button class="btn btn-primary" type="submit">Salvar</button>
              <a href="{% url 'clientes:cliente_list' %}" class="btn btn-secondary">Voltar</a>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Reuse same masks as cliente_list
function maskCPF(v){
  v=v.replace(/\D/g,'');
  v=v.replace(/(\d{3})(\d)/,'$1.$2');
  v=v.replace(/(\d{3})(\d)/,'$1.$2');
  v=v.replace(/(\d{3})(\d{1,2})$/,'$1-$2');
  return v;
}
function maskPhone(v){
  v=v.replace(/\D/g,'');
  if(v.length>10){
    v=v.replace(/(\d{2})(\d{5})(\d{4})/,'($1) $2-$3');
  } else if(v.length>6){
    v=v.replace(/(\d{2})(\d{4})(\d{0,4})/,'($1) $2-$3');
  } else if(v.length>2){
    v=v.replace(/(\d{2})(\d+)/,'($1) $2');
  }
  return v;
}

document.addEventListener('DOMContentLoaded', function(){
  var cpfInput = document.querySelector('input[name="cpf"]');
  var telInput = document.querySelector('input[name="telefone"]');
  if(cpfInput){
    cpfInput.addEventListener('input', function(e){ this.value = maskCPF(this.value); });
  }
  if(telInput){
    telInput.addEventListener('input', function(e){ this.value = maskPhone(this.value); });
  }
});
</script>
{% endblock %}
