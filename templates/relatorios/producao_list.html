{% extends 'base.html' %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="d-flex flex-wrap justify-content-between align-items-center mb-4 gap-2">
    <div>
      <h1 class="h3 mb-0"><i class="bi bi-list-ul text-primary"></i> {{ title }}</h1>
      <small class="text-muted">Registros de produção diária por pedreiro</small>
    </div>
    <div class="d-flex gap-2">
      <a href="{% url 'relatorios:dashboard' %}" class="btn btn-outline-secondary btn-sm">
        <i class="bi bi-bar-chart-line"></i> Relatórios
      </a>
      <a href="{% url 'relatorios:producao_create' %}" class="btn btn-primary btn-sm">
        <i class="bi bi-plus-lg"></i> Nova Produção
      </a>
    </div>
  </div>

  <div class="card shadow-sm" style="border:none; border-radius:.75rem">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>Data</th>
              <th>Pedreiro</th>
              <th>Obra</th>
              <th>Etapa</th>
              <th class="text-center">m² Exec.</th>
              <th class="text-center">Clima</th>
              <th class="text-center">Ociosidade</th>
              <th class="text-center">Retrabalho</th>
              <th class="text-center">Ações</th>
            </tr>
          </thead>
          <tbody>
            {% for p in producoes %}
            <tr>
              <td>{{ p.data|date:"d/m/Y" }}</td>
              <td>{{ p.funcionario.nome_completo }}</td>
              <td>{{ p.obra.nome }}</td>
              <td>{{ p.etapa }}</td>
              <td class="text-center fw-bold">{{ p.metragem_executada }}</td>
              <td class="text-center">
                {% if p.clima == 'sol' %}
                  <span class="badge bg-warning text-dark"><i class="bi bi-sun"></i> Sol</span>
                {% elif p.clima == 'chuva' %}
                  <span class="badge bg-info text-dark"><i class="bi bi-cloud-rain"></i> Chuva</span>
                {% else %}
                  <span class="badge bg-secondary"><i class="bi bi-cloud"></i> Nublado</span>
                {% endif %}
              </td>
              <td class="text-center">
                {% if p.houve_ociosidade %}
                  <span class="badge bg-warning text-dark">Sim</span>
                {% else %}
                  <span class="text-muted">—</span>
                {% endif %}
              </td>
              <td class="text-center">
                {% if p.houve_retrabalho %}
                  <span class="badge bg-danger">Sim</span>
                {% else %}
                  <span class="text-muted">—</span>
                {% endif %}
              </td>
              <td class="text-center">
                <a href="{% url 'relatorios:producao_edit' p.pk %}" class="btn btn-outline-primary btn-sm" title="Editar">
                  <i class="bi bi-pencil"></i>
                </a>
                <a href="{% url 'relatorios:producao_delete' p.pk %}" class="btn btn-outline-danger btn-sm" title="Excluir">
                  <i class="bi bi-trash"></i>
                </a>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="9" class="text-center text-muted py-4">
                <i class="bi bi-inbox" style="font-size:2rem;display:block;margin-bottom:.5rem"></i>
                Nenhuma produção registrada.
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Paginação -->
  {% if producoes.has_other_pages %}
  <nav class="mt-3">
    <ul class="pagination pagination-sm justify-content-center">
      {% if producoes.has_previous %}
        <li class="page-item"><a class="page-link" href="?page={{ producoes.previous_page_number }}">&laquo;</a></li>
      {% endif %}
      {% for num in producoes.paginator.page_range %}
        {% if producoes.number == num %}
          <li class="page-item active"><span class="page-link">{{ num }}</span></li>
        {% elif num > producoes.number|add:'-3' and num < producoes.number|add:'3' %}
          <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
        {% endif %}
      {% endfor %}
      {% if producoes.has_next %}
        <li class="page-item"><a class="page-link" href="?page={{ producoes.next_page_number }}">&raquo;</a></li>
      {% endif %}
    </ul>
  </nav>
  {% endif %}

</div>
{% endblock %}
