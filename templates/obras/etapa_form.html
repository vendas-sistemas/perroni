{% extends 'base.html' %}

{% block title %}{{ title }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<style>
  .form-card { border: none; border-radius: .75rem; }
  .form-header { border-radius: .75rem .75rem 0 0; padding: .6rem 1rem; }
</style>
{% endblock %}

{% block content %}

<!-- Header -->
<div class="d-flex flex-wrap justify-content-between align-items-center mb-3 gap-2">
  <h1 class="h3 mb-0"><i class="bi bi-pencil-square text-primary"></i> {{ title }}</h1>
  <a href="{% url 'obras:etapa_detail' etapa.pk %}" class="btn btn-outline-secondary btn-sm d-flex align-items-center gap-1">
    <i class="bi bi-arrow-left"></i> Voltar
  </a>
</div>

<div class="row">
  <div class="col-lg-8">
    <div class="card form-card shadow-sm">
      <div class="form-header bg-primary bg-opacity-10">
        <h6 class="mb-0 text-primary"><i class="bi bi-layers"></i> Dados da Etapa</h6>
      </div>
      <div class="card-body">
        <form method="post" novalidate>
          {% csrf_token %}

          {% if form.non_field_errors %}
          <div class="alert alert-danger alert-sm mb-3">
            {% for error in form.non_field_errors %}<div><i class="bi bi-exclamation-triangle-fill"></i> {{ error }}</div>{% endfor %}
          </div>
          {% endif %}

          {% for field in form %}
            {% if field.name == 'concluida' %}
            <div class="form-check form-switch mb-3">
              {{ field }}
              <label class="form-check-label fw-semibold small" for="{{ field.id_for_label }}">
                <i class="bi bi-check-circle text-success"></i> {{ field.label }}
              </label>
              {% if field.errors %}<div class="invalid-feedback d-block">{{ field.errors|striptags }}</div>{% endif %}
            </div>
            {% else %}
            <div class="mb-3">
              <label for="{{ field.id_for_label }}" class="form-label fw-semibold small">
                {% if field.name == 'numero_etapa' %}<i class="bi bi-hash text-primary"></i>
                {% elif field.name == 'percentual_valor' %}<i class="bi bi-percent text-primary"></i>
                {% elif field.name == 'data_inicio' %}<i class="bi bi-calendar-event text-primary"></i>
                {% elif field.name == 'data_termino' %}<i class="bi bi-calendar-check text-primary"></i>
                {% else %}<i class="bi bi-input-cursor text-primary"></i>
                {% endif %}
                {{ field.label }}
              </label>
              {{ field }}
              {% if field.help_text %}<div class="form-text">{{ field.help_text }}</div>{% endif %}
              {% if field.errors %}<div class="invalid-feedback d-block">{{ field.errors|striptags }}</div>{% endif %}
            </div>
            {% endif %}
          {% endfor %}

          <div class="d-flex gap-2 mt-3">
            <button type="submit" class="btn btn-primary d-flex align-items-center gap-1">
              <i class="bi bi-check-lg"></i> Salvar
            </button>
            <a href="{% url 'obras:etapa_detail' etapa.pk %}" class="btn btn-outline-secondary d-flex align-items-center gap-1">
              <i class="bi bi-x-lg"></i> Cancelar
            </a>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

{% endblock %}
