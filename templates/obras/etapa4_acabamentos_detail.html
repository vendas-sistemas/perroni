{% extends 'base.html' %}

{% block title %}Acabamentos - {{ etapa.obra.nome }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<style>
  .form-card { border: none; border-radius: .75rem; }
  .form-header { border-radius: .75rem .75rem 0 0; padding: .6rem 1rem; }
  .field-icon { width: 18px; text-align: center; }
</style>
{% endblock %}

{% block content %}

<!-- Header -->
<div class="d-flex flex-wrap justify-content-between align-items-center mb-3 gap-2">
  <div>
    <h1 class="h3 mb-0"><i class="bi bi-paint-bucket text-primary"></i> Acabamentos</h1>
    <div class="text-muted small mt-1">
      <i class="bi bi-building"></i> {{ etapa.obra.nome }}
      {% if etapa.obra.cliente %}<span class="ms-2"><i class="bi bi-person"></i> {{ etapa.obra.cliente.nome }}</span>{% endif %}
    </div>
  </div>
  <a href="{% url 'obras:obra_etapas' etapa.obra.pk %}" class="btn btn-outline-secondary btn-sm d-flex align-items-center gap-1">
    <i class="bi bi-arrow-left"></i> Voltar às Etapas
  </a>
</div>

<div class="row">
  <div class="col-lg-8">
    <div class="card form-card shadow-sm">
      <div class="form-header" style="background: rgba(111,66,193,.1);">
        <h6 class="mb-0" style="color: #6f42c1;"><i class="bi bi-paint-bucket"></i> Etapa 4 — Acabamentos (84%)</h6>
      </div>
      <div class="card-body">
        <form method="post" novalidate>
          {% csrf_token %}
          {% if form.non_field_errors %}
          <div class="alert alert-danger alert-sm mb-3">
            {% for error in form.non_field_errors %}<div><i class="bi bi-exclamation-triangle-fill"></i> {{ error }}</div>{% endfor %}
          </div>
          {% endif %}

          {% for field in form %}
            {% if field.field.widget.input_type == 'checkbox' %}
            <div class="form-check form-switch mb-3">
              {{ field }}
              <label class="form-check-label fw-semibold small" for="{{ field.id_for_label }}">
                <i class="bi bi-check-circle field-icon text-success"></i> {{ field.label }}
              </label>
              {% if field.help_text %}<div class="form-text">{{ field.help_text }}</div>{% endif %}
              {% if field.errors %}<div class="invalid-feedback d-block">{{ field.errors|striptags }}</div>{% endif %}
            </div>
            {% else %}
            <div class="mb-3">
              <label for="{{ field.id_for_label }}" class="form-label fw-semibold small">
                <i class="bi bi-rulers field-icon text-primary"></i> {{ field.label }}
              </label>
              {{ field }}
              {% if field.help_text %}<div class="form-text">{{ field.help_text }}</div>{% endif %}
              {% if field.errors %}<div class="invalid-feedback d-block">{{ field.errors|striptags }}</div>{% endif %}
            </div>
            {% endif %}
          {% endfor %}

          <div class="d-flex gap-2 mt-3">
            <button type="submit" class="btn btn-primary d-flex align-items-center gap-1">
              <i class="bi bi-check-lg"></i> Salvar
            </button>
            <a href="{% url 'obras:obra_etapas' etapa.obra.pk %}" class="btn btn-outline-secondary d-flex align-items-center gap-1">
              <i class="bi bi-x-lg"></i> Cancelar
            </a>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

{% endblock %}
